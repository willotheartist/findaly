generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum PricingModel {
  FREE
  FREEMIUM
  PAID
  ENTERPRISE
}

enum PricingPeriod {
  MONTH
  YEAR
  ONE_TIME
  UNKNOWN
}

enum SubmissionStatus {
  NEW
  REVIEWED
  APPROVED
  REJECTED
}

enum ToolStatus {
  ACTIVE
  DISCONTINUED
  DRAFT
}

enum DataConfidence {
  SEEDED
  ENRICHED
  VERIFIED
}

model Tool {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name String
  slug String @unique

  // Copy
  tagline          String?
  shortDescription String
  longDescription  String?

  // URLs / assets
  websiteUrl String?
  pricingUrl String?
  logoUrl    String?

  // Pricing (baseline)
  pricingModel  PricingModel
  startingPrice String?
  pricingNotes  String?

  // Pricing (structured)
  startingPriceCents  Int?
  startingPricePeriod PricingPeriod @default(UNKNOWN)
  hasFreePlan         Boolean?
  hasFreeTrial        Boolean?
  trialDays           Int?

  // Structured “decision layer”
  bestFor       String[] @default([])
  notFor        String[] @default([])
  pros          String[] @default([])
  cons          String[] @default([])
  switchReasons String[] @default([])

  // Existing arrays (keep)
  targetAudience String[] @default([])
  keyFeatures    String[] @default([])
  integrations   String[] @default([])

  // Comparisons (normalized flags)
  // Example: {"has_api": true, "sso": false, "mobile_app": true}
  featureFlags Json @default("{}")

  // “Replaces / replaced by” intent
  replacementFor String[] @default([])

  // Trust / freshness
  status         ToolStatus     @default(ACTIVE)
  isFeatured     Boolean        @default(false)
  lastVerifiedAt DateTime?
  dataConfidence DataConfidence @default(SEEDED)

  // Category relations
  primaryCategoryId String
  primaryCategory   Category @relation(fields: [primaryCategoryId], references: [id])

  secondaryCategories Category[] @relation("SecondaryCategories")
  useCases            UseCase[]  @relation("ToolUseCases")

  // Explicit alternatives graph (optional; you can still compute alternatives)
  alternativesFrom ToolAlternative[] @relation("ToolAlt")
  alternativesTo   ToolAlternative[] @relation("AltTool")

  // Submissions inbox links (optional)
  submissions Submission[]

  @@index([primaryCategoryId])
  @@index([primaryCategoryId, status])
  @@index([dataConfidence, status])
  @@index([lastVerifiedAt])
}

model Category {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String
  slug        String  @unique
  description String?

  parentId String?
  parent   Category?  @relation("CategoryTree", fields: [parentId], references: [id])
  children Category[] @relation("CategoryTree")

  tools     Tool[]
  secondary Tool[] @relation("SecondaryCategories")

  @@index([slug])
  @@index([parentId])
}

model UseCase {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String
  slug        String  @unique
  description String?

  tools Tool[] @relation("ToolUseCases")

  @@index([slug])
}

model ToolAlternative {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  toolId        String
  alternativeId String

  score Int     @default(0)
  note  String?

  tool        Tool @relation("ToolAlt", fields: [toolId], references: [id])
  alternative Tool @relation("AltTool", fields: [alternativeId], references: [id])

  @@unique([toolId, alternativeId])
  @@index([toolId])
  @@index([alternativeId])
}

model Submission {
  id        String    @id @default(cuid())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  status SubmissionStatus @default(NEW)

  name       String
  websiteUrl String?
  category   String?
  notes      String?
  email      String?

  // lightweight anti-spam / ops
  ip        String?
  userAgent String?

  // once you convert a submission into a tool, optionally link it
  toolId String?
  tool   Tool?   @relation(fields: [toolId], references: [id])

  @@index([status, createdAt])
  @@index([toolId])
}
