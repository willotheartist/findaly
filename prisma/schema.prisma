generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum PricingModel {
  FREE
  FREEMIUM
  PAID
  ENTERPRISE
}

enum PricingPeriod {
  MONTH
  YEAR
  ONE_TIME
  UNKNOWN
}

enum SubmissionStatus {
  NEW
  REVIEWED
  APPROVED
  REJECTED
}

enum ToolStatus {
  ACTIVE
  DISCONTINUED
  DRAFT
}

enum DataConfidence {
  SEEDED
  ENRICHED
  VERIFIED
}

model Tool {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name String
  slug String @unique

  tagline          String?
  shortDescription String
  longDescription  String?

  websiteUrl String?
  pricingUrl String?
  logoUrl    String?

  pricingModel  PricingModel
  startingPrice String?
  pricingNotes  String?

  startingPriceCents  Int?
  startingPricePeriod PricingPeriod @default(UNKNOWN)
  hasFreePlan         Boolean?
  hasFreeTrial        Boolean?
  trialDays           Int?

  bestFor       String[] @default([])
  notFor        String[] @default([])
  pros          String[] @default([])
  cons          String[] @default([])
  switchReasons String[] @default([])

  targetAudience String[] @default([])
  keyFeatures    String[] @default([])
  integrations   String[] @default([])

  featureFlags Json @default("{}")
  replacementFor String[] @default([])

  status         ToolStatus     @default(ACTIVE)
  isFeatured     Boolean        @default(false)
  lastVerifiedAt DateTime?
  dataConfidence DataConfidence @default(SEEDED)

  findalyScore     Float?
  findalyScoreMeta Json?

  primaryCategoryId String
  primaryCategory   Category @relation(fields: [primaryCategoryId], references: [id])

  secondaryCategories Category[] @relation("SecondaryCategories")
  useCases            UseCase[]  @relation("ToolUseCases")

  alternativesFrom ToolAlternative[] @relation("ToolAlt")
  alternativesTo   ToolAlternative[] @relation("AltTool")

  submissions Submission[]
  toolSources ToolSource[]

  // âœ… this is the missing connection
  externalClaims ExternalClaim[]

  @@index([primaryCategoryId])
  @@index([primaryCategoryId, status])
  @@index([dataConfidence, status])
  @@index([lastVerifiedAt])
}

model Category {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String
  slug        String  @unique
  description String?

  parentId String?
  parent   Category?  @relation("CategoryTree", fields: [parentId], references: [id])
  children Category[] @relation("CategoryTree")

  tools     Tool[]
  secondary Tool[] @relation("SecondaryCategories")

  @@index([slug])
  @@index([parentId])
}

model UseCase {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  name        String
  slug        String  @unique
  description String?

  tools Tool[] @relation("ToolUseCases")

  @@index([slug])
}

model ToolAlternative {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  toolId        String
  alternativeId String

  score Int     @default(0)
  note  String?

  tool        Tool @relation("ToolAlt", fields: [toolId], references: [id])
  alternative Tool @relation("AltTool", fields: [alternativeId], references: [id])

  @@unique([toolId, alternativeId])
  @@index([toolId])
  @@index([alternativeId])
}

model Submission {
  id        String    @id @default(cuid())
  createdAt DateTime  @default(now())
  updatedAt DateTime? @updatedAt

  status SubmissionStatus @default(NEW)

  name       String
  websiteUrl String?
  category   String?
  notes      String?
  email      String?

  ip        String?
  userAgent String?

  toolId String?
  tool   Tool?   @relation(fields: [toolId], references: [id])

  @@index([status, createdAt])
  @@index([toolId])
}

model ToolSource {
  id        String   @id @default(cuid())
  toolId    String
  type      String
  url       String
  meta      Json     @default("{}")
  fetchedAt DateTime @default(now())

  tool Tool @relation(fields: [toolId], references: [id])

  @@unique([toolId, type], name: "toolId_type")
  @@index([toolId, type])
}

model ExternalClaim {
  id         String   @id @default(cuid())
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  toolId     String
  tool       Tool     @relation(fields: [toolId], references: [id])

  sourceType String
  sourceUrl  String

  topic      String
  sentiment  Int
  claim      String
  strength   Float    @default(0.5)
  evidence   Json?

  @@index([toolId, topic])
  @@index([toolId, sourceType])
  @@index([sourceType])
}
